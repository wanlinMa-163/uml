<mxfile host="app.diagrams.net" modified="2021-01-14T01:44:57.135Z" agent="5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Safari/537.36" etag="nZ4dnjDiIoCLKWznfRyY" version="14.2.2" type="github">
  <diagram id="Sv0BJPYfw8yJLw7PNm5L" name="Page-1">
    <mxGraphModel dx="1422" dy="1931" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-1" value=":前台" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;" parent="1" vertex="1">
          <mxGeometry x="20" width="100" height="2060" as="geometry" />
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-2" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;fontFamily=Verdana;" parent="TlyRNE7s7NfoEoWf2oxe-1" target="TlyRNE7s7NfoEoWf2oxe-6" edge="1">
          <mxGeometry x="-0.0095" y="20" width="80" relative="1" as="geometry">
            <mxPoint x="60" y="70" as="sourcePoint" />
            <mxPoint x="140" y="70" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-3" value="访问/user/**接口，携带之前的用户token" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontFamily=Verdana;" parent="TlyRNE7s7NfoEoWf2oxe-2" vertex="1" connectable="0">
          <mxGeometry x="0.1799" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-4" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;" parent="TlyRNE7s7NfoEoWf2oxe-1" vertex="1">
          <mxGeometry x="42.5" y="50" width="15" height="1830" as="geometry" />
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-5" value=":gateway" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;" parent="1" vertex="1">
          <mxGeometry x="350" width="100" height="2060" as="geometry" />
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-6" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;" parent="TlyRNE7s7NfoEoWf2oxe-5" vertex="1">
          <mxGeometry x="42.5" y="60" width="15" height="1830" as="geometry" />
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-7" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;fontFamily=Verdana;" parent="TlyRNE7s7NfoEoWf2oxe-5" vertex="1">
          <mxGeometry x="57.5" y="130" width="10" height="40" as="geometry" />
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-8" value="self call" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;entryX=1;entryY=0;fontFamily=Verdana;" parent="TlyRNE7s7NfoEoWf2oxe-5" target="TlyRNE7s7NfoEoWf2oxe-7" edge="1">
          <mxGeometry x="-0.2305" y="23" relative="1" as="geometry">
            <mxPoint x="63" y="80" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="88" y="80" />
            </Array>
            <mxPoint x="-11" y="-20" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-9" value="判断是否是非sso的请求，是执行下列步骤" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontFamily=Verdana;" parent="TlyRNE7s7NfoEoWf2oxe-8" vertex="1" connectable="0">
          <mxGeometry x="-0.1606" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-34" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;" parent="TlyRNE7s7NfoEoWf2oxe-5" vertex="1">
          <mxGeometry x="57.5" y="250" width="11" height="40" as="geometry" />
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-35" value="self call" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;entryX=1;entryY=0;" parent="TlyRNE7s7NfoEoWf2oxe-5" target="TlyRNE7s7NfoEoWf2oxe-34" edge="1">
          <mxGeometry x="-0.2308" y="-20" relative="1" as="geometry">
            <mxPoint x="57.5" y="200" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="83" y="200" />
              <mxPoint x="83" y="250" />
            </Array>
            <mxPoint x="20" y="-20" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-36" value="获取请求头Authorization，没有则报错，有则执行下列步骤" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="TlyRNE7s7NfoEoWf2oxe-35" vertex="1" connectable="0">
          <mxGeometry x="-0.137" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-42" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;" parent="TlyRNE7s7NfoEoWf2oxe-5" target="TlyRNE7s7NfoEoWf2oxe-23" edge="1">
          <mxGeometry x="0.0007" y="30" width="80" relative="1" as="geometry">
            <mxPoint x="60" y="320" as="sourcePoint" />
            <mxPoint x="140" y="320" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-44" value="获取此gateway的service account token" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="TlyRNE7s7NfoEoWf2oxe-42" vertex="1" connectable="0">
          <mxGeometry x="0.089" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-46" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;entryX=0;entryY=0.073;entryDx=0;entryDy=0;entryPerimeter=0;" parent="TlyRNE7s7NfoEoWf2oxe-5" target="TlyRNE7s7NfoEoWf2oxe-47" edge="1">
          <mxGeometry x="0.0007" y="30" width="80" relative="1" as="geometry">
            <mxPoint x="60" y="530" as="sourcePoint" />
            <mxPoint x="140" y="530" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-48" value="openfeign 调用sso-server 的 /introspect 接口验证并获取此用户信息" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="TlyRNE7s7NfoEoWf2oxe-46" vertex="1" connectable="0">
          <mxGeometry x="-0.1513" y="-2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-66" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;" parent="TlyRNE7s7NfoEoWf2oxe-5" vertex="1">
          <mxGeometry x="57.5" y="770" width="10" height="40" as="geometry" />
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-67" value="self call" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;entryX=1;entryY=0;" parent="TlyRNE7s7NfoEoWf2oxe-5" target="TlyRNE7s7NfoEoWf2oxe-66" edge="1">
          <mxGeometry x="-0.4118" y="-10" relative="1" as="geometry">
            <mxPoint x="63" y="680" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="63" y="680" />
              <mxPoint x="88" y="680" />
              <mxPoint x="88" y="720" />
            </Array>
            <mxPoint x="10" y="-10" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-68" value="根据此用户token的信息，获取active 字段是true，还是false。&lt;br&gt;如果是false，返回登录过期，&lt;br&gt;如果是true，执行下列请求。" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="TlyRNE7s7NfoEoWf2oxe-67" vertex="1" connectable="0">
          <mxGeometry x="-0.1725" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-69" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;" parent="TlyRNE7s7NfoEoWf2oxe-5" vertex="1">
          <mxGeometry x="57.5" y="1100" width="10" height="40" as="geometry" />
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-70" value="self call" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;entryX=1;entryY=0;" parent="TlyRNE7s7NfoEoWf2oxe-5" target="TlyRNE7s7NfoEoWf2oxe-69" edge="1">
          <mxGeometry x="-0.2308" y="23" relative="1" as="geometry">
            <mxPoint x="64" y="1040" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="89" y="1040" />
              <mxPoint x="89" y="1110" />
              <mxPoint x="68" y="1110" />
            </Array>
            <mxPoint x="-12" y="-20" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-71" value="将用户信息放入，请求头，key是USER_AUTHENTICATION_CONTEXT&lt;br&gt;将此gateway的 service account token放入Authorization: Bearer token" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="TlyRNE7s7NfoEoWf2oxe-70" vertex="1" connectable="0">
          <mxGeometry x="-0.2178" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-78" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;" parent="TlyRNE7s7NfoEoWf2oxe-5" target="TlyRNE7s7NfoEoWf2oxe-75" edge="1">
          <mxGeometry x="0.0013" y="30" width="80" relative="1" as="geometry">
            <mxPoint x="60" y="1190" as="sourcePoint" />
            <mxPoint x="150" y="1190" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-80" value="访问 provider-user服务的：/user/admin接口" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="TlyRNE7s7NfoEoWf2oxe-78" vertex="1" connectable="0">
          <mxGeometry x="0.1111" y="-3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-94" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;" parent="TlyRNE7s7NfoEoWf2oxe-5" target="TlyRNE7s7NfoEoWf2oxe-75" edge="1">
          <mxGeometry x="-0.0286" y="30" width="80" relative="1" as="geometry">
            <mxPoint x="60" y="1440" as="sourcePoint" />
            <mxPoint x="410" y="1440" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-95" value="访问provider-user服务的：/user/pay接口" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="TlyRNE7s7NfoEoWf2oxe-94" vertex="1" connectable="0">
          <mxGeometry x="0.1429" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-16" value=":sso-server" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;" parent="1" vertex="1">
          <mxGeometry x="1340" width="100" height="2040" as="geometry" />
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-47" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;" parent="TlyRNE7s7NfoEoWf2oxe-16" vertex="1">
          <mxGeometry x="45" y="520" width="10" height="120" as="geometry" />
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-23" value=":授权服务器" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;" parent="1" vertex="1">
          <mxGeometry x="1670" width="100" height="1990" as="geometry" />
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-43" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;" parent="TlyRNE7s7NfoEoWf2oxe-23" vertex="1">
          <mxGeometry x="45" y="320" width="10" height="70" as="geometry" />
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-59" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;" parent="TlyRNE7s7NfoEoWf2oxe-23" vertex="1">
          <mxGeometry x="45" y="520" width="10" height="120" as="geometry" />
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-61" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;" parent="TlyRNE7s7NfoEoWf2oxe-23" vertex="1">
          <mxGeometry x="55" y="570" width="10" height="40" as="geometry" />
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-62" value="self call" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;entryX=1;entryY=0;" parent="TlyRNE7s7NfoEoWf2oxe-23" target="TlyRNE7s7NfoEoWf2oxe-61" edge="1">
          <mxGeometry x="-0.2308" y="-20" relative="1" as="geometry">
            <mxPoint x="60" y="550" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="85" y="550" />
            </Array>
            <mxPoint x="20" y="-20" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-63" value="校验，有效返回用户信息active:true，无效返回active:false" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="TlyRNE7s7NfoEoWf2oxe-62" vertex="1" connectable="0">
          <mxGeometry x="-0.2821" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-107" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;" parent="TlyRNE7s7NfoEoWf2oxe-23" vertex="1">
          <mxGeometry x="45" y="1590" width="10" height="30" as="geometry" />
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-39" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;" parent="1" vertex="1">
          <mxGeometry x="407.5" y="470" width="11" height="40" as="geometry" />
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-40" value="self call" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;entryX=1;entryY=0;" parent="1" target="TlyRNE7s7NfoEoWf2oxe-39" edge="1">
          <mxGeometry x="-0.2308" y="-20" relative="1" as="geometry">
            <mxPoint x="407.5" y="420" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="433" y="420" />
              <mxPoint x="433" y="470" />
            </Array>
            <mxPoint x="20" y="-20" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-41" value="获得Authorization，移除原来的Authorization，&lt;br&gt;将此gateway的 service account token放入Authorization: Bearer token" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="TlyRNE7s7NfoEoWf2oxe-40" vertex="1" connectable="0">
          <mxGeometry x="-0.137" y="1" relative="1" as="geometry">
            <mxPoint y="6.33" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-45" value="return" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;exitX=0.167;exitY=0.964;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="TlyRNE7s7NfoEoWf2oxe-43" target="TlyRNE7s7NfoEoWf2oxe-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1070" y="410" as="sourcePoint" />
            <mxPoint x="990" y="410" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-54" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="TlyRNE7s7NfoEoWf2oxe-53" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1390" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-83" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="TlyRNE7s7NfoEoWf2oxe-53" target="TlyRNE7s7NfoEoWf2oxe-75" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-84" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="TlyRNE7s7NfoEoWf2oxe-53" target="TlyRNE7s7NfoEoWf2oxe-76" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-53" value="每发过来一个请求都需要验证调用方，是否有权限调用自己" style="shape=note2;boundedLbl=1;whiteSpace=wrap;html=1;size=20;verticalAlign=top;align=center;" parent="1" vertex="1">
          <mxGeometry x="1050" y="-340" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-55" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;" parent="1" edge="1">
          <mxGeometry x="0.0018" y="30" width="80" relative="1" as="geometry">
            <mxPoint x="1400" y="530" as="sourcePoint" />
            <mxPoint x="1715" y="530" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-60" value="携带此sso server的clientId和client secert&lt;br&gt;去验证此token" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="TlyRNE7s7NfoEoWf2oxe-55" vertex="1" connectable="0">
          <mxGeometry x="-0.1642" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-64" value="return" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;" parent="1" target="TlyRNE7s7NfoEoWf2oxe-16" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1720" y="640" as="sourcePoint" />
            <mxPoint x="1640" y="640" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-65" value="return" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;exitX=0.167;exitY=0.967;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="TlyRNE7s7NfoEoWf2oxe-47" target="TlyRNE7s7NfoEoWf2oxe-6" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1140" y="640" as="sourcePoint" />
            <mxPoint x="680" y="640" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-72" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;" parent="1" vertex="1">
          <mxGeometry x="407.5" y="920" width="10" height="40" as="geometry" />
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-73" value="self call" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;entryX=1;entryY=0;" parent="1" target="TlyRNE7s7NfoEoWf2oxe-72" edge="1">
          <mxGeometry x="-0.2308" y="23" relative="1" as="geometry">
            <mxPoint x="414" y="840" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="439" y="840" />
              <mxPoint x="439" y="910" />
              <mxPoint x="418" y="910" />
            </Array>
            <mxPoint x="-12" y="-20" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-74" value="获取用户角色，与所允许访问的路径进行匹配，如果不角色不允许访问某些路径&lt;br&gt;返回，无权限访问，&lt;br&gt;否则，执行下列步骤" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="TlyRNE7s7NfoEoWf2oxe-73" vertex="1" connectable="0">
          <mxGeometry x="-0.2178" y="-1" relative="1" as="geometry">
            <mxPoint y="15.83" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-75" value=":provider-user" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;" parent="1" vertex="1">
          <mxGeometry x="740" y="5" width="100" height="2050" as="geometry" />
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-79" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;" parent="TlyRNE7s7NfoEoWf2oxe-75" vertex="1">
          <mxGeometry x="45" y="1190" width="10" height="160" as="geometry" />
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-90" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;" parent="TlyRNE7s7NfoEoWf2oxe-75" vertex="1">
          <mxGeometry x="55" y="1255" width="10" height="70" as="geometry" />
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-91" value="self call" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;entryX=1;entryY=0;" parent="TlyRNE7s7NfoEoWf2oxe-75" target="TlyRNE7s7NfoEoWf2oxe-90" edge="1">
          <mxGeometry x="-0.5" y="35" relative="1" as="geometry">
            <mxPoint x="60" y="1200" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="85" y="1200" />
            </Array>
            <mxPoint x="-30" y="-35" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-92" value="&lt;span style=&quot;font-size: 12px ; background-color: rgb(248 , 249 , 250)&quot;&gt;请求头 ：&lt;/span&gt;&lt;span&gt;USER_AUTHENTICATION_CONTEXT&lt;br&gt;来转成 Controller的用户信息参数&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="TlyRNE7s7NfoEoWf2oxe-91" vertex="1" connectable="0">
          <mxGeometry x="-0.3467" y="1" relative="1" as="geometry">
            <mxPoint x="1" y="17.5" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-96" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;" parent="TlyRNE7s7NfoEoWf2oxe-75" vertex="1">
          <mxGeometry x="45" y="1435" width="10" height="455" as="geometry" />
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-105" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;" parent="TlyRNE7s7NfoEoWf2oxe-75" target="TlyRNE7s7NfoEoWf2oxe-23" edge="1">
          <mxGeometry x="0.0169" y="20" width="80" relative="1" as="geometry">
            <mxPoint x="60" y="1585" as="sourcePoint" />
            <mxPoint x="650" y="1585" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-106" value="获取此客户端provider-user的service account token" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="TlyRNE7s7NfoEoWf2oxe-105" vertex="1" connectable="0">
          <mxGeometry x="0.0819" y="-3" relative="1" as="geometry">
            <mxPoint y="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-110" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;" parent="TlyRNE7s7NfoEoWf2oxe-75" target="TlyRNE7s7NfoEoWf2oxe-76" edge="1">
          <mxGeometry x="0.0339" y="30" width="80" relative="1" as="geometry">
            <mxPoint x="60" y="1805" as="sourcePoint" />
            <mxPoint x="140" y="1805" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-112" value="openfeign调用provider-order：的/order接口" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="TlyRNE7s7NfoEoWf2oxe-110" vertex="1" connectable="0">
          <mxGeometry x="0.287" relative="1" as="geometry">
            <mxPoint x="-29.17" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-76" value=":provider-order" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;" parent="1" vertex="1">
          <mxGeometry x="1060" width="100" height="2050" as="geometry" />
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-111" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;" parent="TlyRNE7s7NfoEoWf2oxe-76" vertex="1">
          <mxGeometry x="45" y="1810" width="10" height="70" as="geometry" />
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-88" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="TlyRNE7s7NfoEoWf2oxe-85" target="TlyRNE7s7NfoEoWf2oxe-75" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-89" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="TlyRNE7s7NfoEoWf2oxe-85" target="TlyRNE7s7NfoEoWf2oxe-76" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-85" value="provider 微服务要可以根据请求头 ：&lt;span style=&quot;font-size: 11px ; background-color: rgb(255 , 255 , 255)&quot;&gt;USER_AUTHENTICATION_CONTEXT&lt;br&gt;来转成 Controller的用户信息参数&lt;/span&gt;" style="shape=note2;boundedLbl=1;whiteSpace=wrap;html=1;size=20;verticalAlign=top;align=center;" parent="1" vertex="1">
          <mxGeometry x="810" y="-150" width="260" height="90" as="geometry" />
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-93" value="return" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;" parent="1" target="TlyRNE7s7NfoEoWf2oxe-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="790" y="1350" as="sourcePoint" />
            <mxPoint x="710" y="1350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-97" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;" parent="1" vertex="1">
          <mxGeometry x="795" y="1495" width="10" height="70" as="geometry" />
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-98" value="self call" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;entryX=1;entryY=0;" parent="1" target="TlyRNE7s7NfoEoWf2oxe-97" edge="1">
          <mxGeometry x="-0.5" y="35" relative="1" as="geometry">
            <mxPoint x="800" y="1440" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="825" y="1440" />
            </Array>
            <mxPoint x="-30" y="-35" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-99" value="&lt;span style=&quot;font-size: 12px ; background-color: rgb(248 , 249 , 250)&quot;&gt;请求头 ：&lt;/span&gt;&lt;span&gt;USER_AUTHENTICATION_CONTEXT&lt;br&gt;来转成 Controller的用户信息参数&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="TlyRNE7s7NfoEoWf2oxe-98" vertex="1" connectable="0">
          <mxGeometry x="-0.3467" y="1" relative="1" as="geometry">
            <mxPoint x="1" y="17.5" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-102" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;" parent="1" vertex="1">
          <mxGeometry x="795" y="1710" width="10" height="70" as="geometry" />
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-103" value="self call" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;entryX=1;entryY=0;" parent="1" target="TlyRNE7s7NfoEoWf2oxe-102" edge="1">
          <mxGeometry x="-0.5" y="35" relative="1" as="geometry">
            <mxPoint x="800" y="1655" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="825" y="1655" />
            </Array>
            <mxPoint x="-30" y="-35" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-104" value="&lt;span style=&quot;font-size: 12px ; background-color: rgb(248 , 249 , 250)&quot;&gt;请求头 ：&lt;/span&gt;&lt;span&gt;USER_AUTHENTICATION_CONTEXT传递到openfeign的请求头，&lt;br&gt;对Openfeign的请求头添加当前客户端的service account token&lt;br&gt;&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="TlyRNE7s7NfoEoWf2oxe-103" vertex="1" connectable="0">
          <mxGeometry x="-0.3467" y="1" relative="1" as="geometry">
            <mxPoint x="1" y="17.5" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-108" value="return" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;" parent="1" target="TlyRNE7s7NfoEoWf2oxe-75" edge="1">
          <mxGeometry x="-0.0326" y="20" relative="1" as="geometry">
            <mxPoint x="1720" y="1620" as="sourcePoint" />
            <mxPoint x="1640" y="1620" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-117" value="return" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;" parent="1" target="TlyRNE7s7NfoEoWf2oxe-75" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1100" y="1880" as="sourcePoint" />
            <mxPoint x="1020" y="1880" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlyRNE7s7NfoEoWf2oxe-118" value="return" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;" parent="1" target="TlyRNE7s7NfoEoWf2oxe-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="790" y="1880" as="sourcePoint" />
            <mxPoint x="710" y="1880" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Oc7H00xBOU0IGudywjiw-1" value="return" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;" parent="1" target="TlyRNE7s7NfoEoWf2oxe-1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="390" y="1880" as="sourcePoint" />
            <mxPoint x="310" y="1880" as="targetPoint" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
